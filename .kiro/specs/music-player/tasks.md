# 实施计划

- [x] 1. 项目初始化和基础架构搭建
  - 创建项目根目录结构（frontend, backend, shared）
  - 初始化前端React + TypeScript + Vite项目
  - 初始化后端Express + TypeScript项目
  - 配置开发环境和构建脚本
  - _需求: 5.3_

- [ ] 2. 后端核心基础设施
- [ ] 2.1 设置Express服务器和中间件
  - 创建Express应用实例和基本路由结构
  - 配置CORS、helmet、body-parser等中间件
  - 实现错误处理中间件和统一响应格式
  - 编写服务器启动和健康检查端点
  - _需求: 5.1, 5.5_

- [ ] 2.2 数据库设置和连接
  - 创建SQLite数据库连接工具
  - 实现数据库初始化脚本（创建表结构）
  - 编写数据库迁移和种子数据功能
  - 创建数据库操作的基础工具函数
  - _需求: 5.2_

- [ ] 2.3 实现共享TypeScript类型定义
  - 定义Track、Playlist、ApiResponse等核心类型
  - 创建API请求和响应的类型接口
  - 实现类型验证工具函数
  - 设置前后端共享类型的导入机制
  - _需求: 1.3, 3.1_

- [ ] 3. 文件上传和处理功能
- [ ] 3.1 实现文件上传API端点
  - 配置Multer中间件处理文件上传
  - 创建文件类型和大小验证逻辑
  - 实现文件重命名和存储路径管理
  - 编写上传错误处理和响应逻辑
  - _需求: 1.1, 1.2, 1.4_

- [ ] 3.2 音频元数据提取和存储
  - 集成music-metadata库提取音频信息
  - 实现元数据解析和清理功能
  - 创建Track数据模型的数据库操作
  - 编写元数据提取失败的降级处理
  - _需求: 1.3_

- [ ] 3.3 音频文件流式传输API
  - 实现音频文件流式读取和传输
  - 添加Range请求支持（支持音频跳转）
  - 创建文件访问权限验证
  - 编写文件不存在和读取错误处理
  - _需求: 2.1, 2.4_

- [ ] 4. 音乐库管理API
- [ ] 4.1 实现音乐列表CRUD操作
  - 创建获取所有音乐文件的API端点
  - 实现按标题、艺术家、专辑搜索功能
  - 添加音乐文件删除API（包括文件系统清理）
  - 编写音乐信息更新API端点
  - _需求: 1.5_

- [ ] 4.2 实现播放列表管理API
  - 创建播放列表CRUD操作的API端点
  - 实现播放列表中添加/移除歌曲的功能
  - 添加播放列表歌曲重新排序功能
  - 编写播放列表数据验证和错误处理
  - _需求: 3.1, 3.2, 3.3, 3.4, 3.5_

- [ ] 5. 前端项目基础架构
- [ ] 5.1 设置React应用和路由
  - 创建React应用的基本组件结构
  - 配置React Router实现页面导航
  - 实现Layout组件（Header, Sidebar, Main）
  - 创建基础页面组件（Library, Upload, Playlist）
  - _需求: 4.1, 4.2_

- [ ] 5.2 状态管理和API客户端
  - 配置Zustand实现全局状态管理
  - 创建API客户端工具（axios配置）
  - 实现React Query用于服务端状态管理
  - 编写API调用的错误处理和重试逻辑
  - _需求: 4.3_

- [ ] 5.3 基础UI组件和样式
  - 配置Tailwind CSS和基础样式
  - 创建可复用的UI组件（Button, Input, Modal等）
  - 实现响应式布局和移动端适配
  - 添加加载状态和错误提示组件
  - _需求: 4.4, 4.5_

- [ ] 6. 文件上传功能实现
- [ ] 6.1 创建文件上传组件
  - 实现拖拽上传和点击选择文件功能
  - 添加上传进度显示和取消上传功能
  - 创建文件类型和大小验证的前端逻辑
  - 实现批量文件上传和错误处理
  - _需求: 1.1, 1.2, 1.4_

- [ ] 6.2 集成上传API和状态管理
  - 连接前端上传组件与后端API
  - 实现上传成功后的音乐库刷新
  - 添加上传历史和重试失败上传功能
  - 编写上传组件的单元测试
  - _需求: 1.3, 1.5_

- [ ] 7. 音频播放器核心功能
- [ ] 7.1 实现基础音频播放组件
  - 创建HTML5 Audio API的封装组件
  - 实现播放、暂停、停止基本控制
  - 添加音量控制和静音功能
  - 编写音频加载和播放错误处理
  - _需求: 2.1, 2.3, 2.5_

- [ ] 7.2 实现播放进度和跳转功能
  - 添加播放进度条和时间显示
  - 实现进度条拖拽跳转功能
  - 创建播放时间格式化工具
  - 编写进度更新和同步逻辑
  - _需求: 2.2, 2.4_

- [ ] 7.3 实现播放队列和自动播放
  - 创建播放队列管理逻辑
  - 实现上一首、下一首切换功能
  - 添加自动播放下一首功能
  - 编写播放模式（顺序、随机、单曲循环）
  - _需求: 2.6_

- [ ] 8. 音乐库界面实现
- [ ] 8.1 创建音乐列表显示组件
  - 实现音乐文件列表的表格/卡片视图
  - 添加排序功能（按标题、艺术家、时长等）
  - 创建搜索和过滤功能
  - 实现虚拟滚动优化大列表性能
  - _需求: 1.5_

- [ ] 8.2 集成播放控制和音乐库
  - 连接音乐列表与播放器组件
  - 实现点击歌曲开始播放功能
  - 添加当前播放歌曲的高亮显示
  - 创建右键菜单（添加到播放列表、删除等）
  - _需求: 2.1_

- [ ] 9. 播放列表功能实现
- [ ] 9.1 创建播放列表管理界面
  - 实现播放列表创建和编辑表单
  - 创建播放列表列表显示组件
  - 添加播放列表删除和重命名功能
  - 实现播放列表详情页面
  - _需求: 3.1, 3.5_

- [ ] 9.2 实现播放列表歌曲管理
  - 创建歌曲添加到播放列表的功能
  - 实现播放列表内歌曲的拖拽排序
  - 添加从播放列表移除歌曲功能
  - 编写播放列表播放和队列集成
  - _需求: 3.2, 3.3, 3.4_

- [ ] 10. 迷你播放器和全局播放状态
- [ ] 10.1 实现底部迷你播放器
  - 创建固定在底部的迷你播放器组件
  - 显示当前播放歌曲信息和基本控制
  - 实现播放器展开/收起功能
  - 确保在页面切换时保持播放状态
  - _需求: 4.3_

- [ ] 10.2 全局播放状态同步
  - 实现全局播放状态的状态管理
  - 确保所有组件能访问和更新播放状态
  - 添加播放状态持久化（localStorage）
  - 编写播放状态变化的事件处理
  - _需求: 5.3_

- [ ] 11. 错误处理和用户体验优化
- [ ] 11.1 实现全面的错误处理
  - 创建全局错误边界组件
  - 实现API错误的用户友好提示
  - 添加网络连接状态检测
  - 编写错误日志记录和报告功能
  - _需求: 1.4, 4.5_

- [ ] 11.2 性能优化和用户体验
  - 实现组件懒加载和代码分割
  - 添加音频预加载和缓存策略
  - 优化大列表渲染性能
  - 创建离线功能和PWA支持
  - _需求: 4.4, 4.5_

- [ ] 12. 测试和部署准备
- [ ] 12.1 编写核心功能测试
  - 创建后端API的单元测试和集成测试
  - 编写前端组件的单元测试
  - 实现端到端测试覆盖主要用户流程
  - 添加测试数据和模拟服务
  - _需求: 所有需求的验证_

- [ ] 12.2 部署配置和文档
  - 创建生产环境构建配置
  - 编写部署脚本和Docker配置
  - 创建用户使用文档和开发文档
  - 实现环境变量配置和安全设置
  - _需求: 5.4, 5.5_